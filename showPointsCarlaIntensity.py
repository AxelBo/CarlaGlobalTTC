import connectionCarla
import carla

import numpy as np
import matplotlib.pyplot as plt
from sklearn.cluster import KMeans, DBSCAN
import pandas as pd

if __name__ == '__main__':
    cc = connectionCarla.CarlaConnection()
    cc.__int__()

    # spawn = connectionCarla.CarlaSpawning()
    # spawn.__int__(cc)
    # spawn.spawnVehicles()
    # spawn.spawnWalker()

    # Example Points from private test
    # points = [[470, -145.516845703125, 17.021421432495117, 622, -144.5475311279297, 5.320837497711182, 2.1735230479472367, 10.09999999999998], [470, -145.5167999267578, 15.784542083740234, 622, -143.83058166503906, 5.32605504989624, 2.453003583698777, 10.19999999999998], [466, -88.04875183105469, 116.07380676269531, 613, -88.93699645996094, 123.43148803710938, 1.2206848401590482, 13.399999999999968], [461, -148.99984741210938, -15.289518356323242, 603, -149.95687866210938, -8.480791091918945, 1.0752415742063832, 17.399999999999977], [461, -149.0004425048828, -14.257460594177246, 603, -149.22882080078125, -8.369646072387695, 0.48447845195881745, 17.49999999999998], [473, 146.9462432861328, 62.449432373046875, 574, 153.73214721679688, 61.34567642211914, 1.087354875477585, 18.799999999999997], [473, 147.11314392089844, 62.44902038574219, 514, 153.7335968017578, 61.43558883666992, 2.5432696949911553, 18.799999999999997], [473, 148.24256896972656, 62.44624710083008, 574, 153.7435760498047, 62.199745178222656, 0.6278216587389494, 18.9], [506, 22.48440170288086, -2.6118948459625244, 580, 23.039899826049805, -13.88349437713623, 2.4980658493469874, 28.300000000000132], [505, 96.79113006591797, 133.21202087402344, 574, 109.82359313964844, 132.64598083496094, 2.0449334537328108, 38.400000000000276], [505, 98.17984771728516, 133.19227600097656, 574, 109.78544616699219, 133.38723754882812, 1.8853775667140134, 38.50000000000028], [482, 84.7171630859375, -79.67642974853516, 572, 73.52409362792969, -86.58274841308594, 2.0327858575521907, 39.800000000000296], [477, 104.07823944091797, 133.1074676513672, 594, 110.09874725341797, 133.99180603027344, 1.6837893367559784, 42.20000000000033], [459, 9.535250663757324, -122.13139343261719, 572, 11.06713581085205, -128.1999053955078, 2.161866985897383, 59.00000000000057], [459, 9.537284851074219, -122.2142333984375, 512, 11.021801948547363, -128.172119140625, 2.571452630020197, 59.00000000000057], [459, 9.550591468811035, -122.75591278076172, 572, 10.72211742401123, -128.04124450683594, 1.6840735509448594, 59.10000000000057], [459, 9.553556442260742, -122.8766098022461, 512, 10.538045883178711, -127.97230529785156, 2.5637920897326416, 59.10000000000057], [459, 9.56827449798584, -123.4755630493164, 572, 9.95229434967041, -127.8857192993164, 0.732510165045619, 59.20000000000057], [459, 9.578001976013184, -123.8671875, 572, 9.1022367477417, -127.98208618164062, 1.7098168122122217, 59.30000000000057], [506, 5.97933292388916, -119.95181274414062, 572, 6.893391132354736, -128.27711486816406, 1.7558880981392264, 59.70000000000058], [506, 6.0013298988342285, -120.81794738769531, 572, 6.313411712646484, -128.32554626464844, 1.3893970902688002, 59.80000000000058], [473, 22.621198654174805, 0.10293201357126236, 615, 22.429079055786133, -13.980280876159668, 2.411573557500102, 61.600000000000605], [473, 22.600934982299805, -1.2421796321868896, 615, 21.961273193359375, -14.344327926635742, 1.933700502105312, 61.70000000000061], [473, 22.51639747619629, -2.688102960586548, 615, 21.642406463623047, -14.596179008483887, 2.077681680737595, 61.80000000000061], [502, -6.096972465515137, 117.88944244384766, 572, -7.203096866607666, 122.60032653808594, 1.2494431674568893, 117.79999999999758], [502, -6.093753337860107, 118.40210723876953, 572, -6.587436199188232, 122.5955810546875, 0.8483110679402279, 117.89999999999758], [502, -6.091094970703125, 118.75078582763672, 572, -5.978960037231445, 122.60433197021484, 1.3179073715369323, 117.99999999999757], [481, -145.51455688476562, 14.061249732971191, 615, -145.79574584960938, 3.536085367202759, 2.0962163071116526, 128.399999999997], [481, -145.51419067382812, 13.030657768249512, 615, -146.4808807373047, 3.468921661376953, 1.8506200676926778, 128.499999999997], [481, -145.5138702392578, 12.022534370422363, 615, -147.16746520996094, 3.342038869857788, 1.8189638538673043, 128.59999999999698], [481, -101.48406219482422, -136.70489501953125, 581, -94.29783630371094, -135.96067810058594, 2.063528579584819, 151.39999999999569], [481, -100.83230590820312, -136.72357177734375, 581, -94.25959014892578, -136.62744140625, 1.7565530523317514, 151.49999999999568], [487, 83.47660827636719, -85.11318969726562, 510, 82.11914825439453, -82.19305419921875, 1.3525343962191574, 158.69999999999527], [487, 83.48464965820312, -85.34522247314453, 510, 82.7876968383789, -82.08305358886719, 0.8181191235775686, 158.79999999999526], [487, 83.49478149414062, -85.63333129882812, 510, 83.52254486083984, -81.96589660644531, 0.2368092671382691, 158.89999999999526], [487, 83.50688934326172, -85.97835540771484, 510, 84.25729370117188, -81.86483001708984, 1.2077972971956021, 158.99999999999525], [487, 83.52163696289062, -86.4007568359375, 510, 85.0260238647461, -81.80967712402344, 2.3610681140999366, 159.09999999999525], [477, -90.15608215332031, -4.930292129516602, 624, -96.77104949951172, 3.125600576400757, 1.4617818940913643, 220.59999999999175], [477, -91.07261657714844, -4.147336006164551, 624, -96.72622680664062, 2.4066009521484375, 0.9433002794567399, 220.69999999999175], [490, 20.965450286865234, -137.8236541748047, 600, 11.182745933532715, -139.4960479736328, 1.9209947785503465, 225.39999999999148], [491, -74.68973541259766, -119.11894226074219, 587, -73.88756561279297, -126.81436920166016, 1.9042514699627273, 247.49999999999022], [491, -74.69172668457031, -119.86444854736328, 587, -74.47233581542969, -126.81014251708984, 1.1521801830619762, 247.59999999999022], [491, -74.69288635253906, -120.6676025390625, 587, -75.17787170410156, -126.8233871459961, 1.0258523568529534, 247.6999999999902], [491, -74.69249725341797, -121.2232894897461, 587, -75.81405639648438, -126.83011627197266, 1.8229797883646077, 247.7999999999902], [466, -9.138760566711426, -208.23753356933594, 612, -11.769789695739746, -207.055908203125, 1.348288067150069, 249.5999999999901], [466, -9.321330070495605, -208.24215698242188, 552, -11.784711837768555, -207.1465606689453, 1.2514094477072106, 249.5999999999901], [466, -9.950984954833984, -208.2581024169922, 612, -11.86406135559082, -207.5100555419922, 0.921381624903401, 249.6999999999901], [466, -9.971234321594238, -208.25860595703125, 552, -11.89098834991455, -207.4490966796875, 2.054126442634434, 249.6999999999901], [464, -71.61930847167969, 2.611724853515625, 594, -68.46995544433594, -5.912024021148682, 1.4854849569376893, 249.7999999999901], [477, -94.60769653320312, -136.9134979248047, 590, -82.90039825439453, -138.4909210205078, 2.3740541693662607, 250.09999999999008], [473, 0.1324339210987091, -152.8832244873047, 572, -2.3084144592285156, -144.77517700195312, 1.2647710461069164, 250.29999999999006], [473, 0.025853514671325684, -151.8377685546875, 572, -1.5704842805862427, -144.6709747314453, 0.6988884693157114, 250.39999999999006], [473, -0.007573454175144434, -151.25222778320312, 572, -0.9818533062934875, -144.60133361816406, 1.7493245155792676, 250.49999999999005], [473, -0.05400557070970535, -150.44561767578125, 572, -0.16407127678394318, -144.518310546875, 1.82405044620406, 250.59999999999005], [486, 11.05318546295166, -130.29815673828125, 521, 8.58830451965332, -126.50485229492188, 1.0749687251853148, 265.49999999999187], [486, 11.05318546295166, -130.29815673828125, 521, 9.17255687713623, -126.47380828857422, 0.8102201977667494, 265.5999999999919], [486, 11.053521156311035, -130.2987518310547, 521, 9.808846473693848, -126.44556427001953, 0.17643836223803835, 265.6999999999919], [486, 11.059011459350586, -130.30838012695312, 521, 10.290634155273438, -126.39265441894531, 0.5320949679566402, 265.79999999999194], [464, -9.622891426086426, 113.82160186767578, 593, -10.568544387817383, 122.61515045166016, 2.0157198506875385, 280.79999999999535], [464, -9.618399620056152, 114.73780822753906, 593, -9.903182029724121, 122.62290954589844, 1.2840231525927335, 280.8999999999954], [466, -88.40656280517578, -15.213150024414062, 610, -89.57643127441406, -7.30075740814209, 1.3530040569498931, 289.4999999999973], [479, 9.098333358764648, 130.9187469482422, 568, 12.15528392791748, 129.93907165527344, 1.081721995374752, 289.99999999999744], [479, 9.098337173461914, 130.9187469482422, 568, 12.412328720092773, 130.6393585205078, 0.5332424168192957, 290.09999999999746], [479, 9.09833812713623, 130.9187469482422, 568, 12.634586334228516, 131.3637237548828, 0.19564022506650097, 290.1999999999975], [479, 9.098339080810547, 130.9187469482422, 568, 12.839608192443848, 132.11886596679688, 0.9900876967608018, 290.2999999999975], [479, 9.098339080810547, 130.9187469482422, 568, 12.90733528137207, 132.37075805664062, 1.4655551619137315, 290.39999999999753], [479, 9.098339080810547, 130.9187469482422, 568, 12.90733528137207, 132.37075805664062, 1.4655551619137315, 290.49999999999756], [479, 9.098339080810547, 130.9187469482422, 568, 12.90733528137207, 132.37075805664062, 1.4655551619137315, 290.5999999999976], [479, 9.098339080810547, 130.9187469482422, 568, 12.90733528137207, 132.37075805664062, 1.4655551619137315, 290.6999999999976], [479, 9.098339080810547, 130.9187469482422, 568, 12.90733528137207, 132.37075805664062, 1.4655551619137315, 290.7999999999976], [479, 9.098339080810547, 130.9187469482422, 568, 12.90733528137207, 132.37075805664062, 1.4655551619137315, 290.89999999999765], [496, 149.75784301757812, -90.39469146728516, 572, 151.8296356201172, -79.51292419433594, 1.1037974865147804, 291.39999999999776], [482, -94.03945922851562, 136.62628173828125, 605, -85.98636627197266, 136.64002990722656, 1.3184778970728572, 294.6999999999985], [482, -93.89590454101562, 136.66705322265625, 545, -85.95063018798828, 136.6165008544922, 2.911091751073982, 294.6999999999985]]

    # Load the data from the file into a pandas DataFrame
    data = pd.read_csv('recordedSituations.txt', header=None)

    # Extract the x and y coordinates for the vehicles
    # Note: X and Y need to be changed in Carla
    y_cords = data[1].astype(float)
    x_cords = data[2].astype(float)
    intensity = data[6].astype(float)

    liste = []
    max_ttc = 1.5
    for x, y, i in zip(x_cords, y_cords, intensity):
        location = carla.Location(x, y, 5)
        ttc = i
        if ttc < max_ttc:
            intensity = (1 - ttc / max_ttc)
            cc.draw_waypoint(location=location, index="x", life_time=999, intensity=intensity)

    exit()
